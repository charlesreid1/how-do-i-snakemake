



<!DOCTYPE html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <meta http-equiv="x-ua-compatible" content="ie=edge">
      
      
        <link rel="canonical" href="https://pages.charlesreid1.com/how-do-i-snakemake/converting/">
      
      
      
        <meta name="lang:clipboard.copy" content="Copy to clipboard">
      
        <meta name="lang:clipboard.copied" content="Copied to clipboard">
      
        <meta name="lang:search.language" content="en">
      
        <meta name="lang:search.pipeline.stopwords" content="True">
      
        <meta name="lang:search.pipeline.trimmer" content="True">
      
        <meta name="lang:search.result.none" content="No matching documents">
      
        <meta name="lang:search.result.one" content="1 matching document">
      
        <meta name="lang:search.result.other" content="# matching documents">
      
        <meta name="lang:search.tokenizer" content="[\s\-]+">
      
      <link rel="shortcut icon" href="../">
      <meta name="generator" content="mkdocs-0.17.3, mkdocs-material-2.7.2">
    
    
      
        <title>Converting Workflows to Snakemake - how do I snakemake?</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application.8d40d89b.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-palette.6079476c.css">
      
    
    
      <script src="../assets/javascripts/modernizr.1aa3b519.js"></script>
    
    
      <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
      
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Bitter:300,400,400i,700|PT+Mono">
        <style>body,input{font-family:"Bitter","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"PT Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../css/custom.css">
    
    
  </head>
  
    
    
    <body dir="ltr" data-md-color-primary="indigo" data-md-color-accent="indigo">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search" autocomplete="off">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <a href="#converting-workflows-to-snakemake" tabindex="1" class="md-skip">
        Skip to content
      </a>
    
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href="https://pages.charlesreid1.com/how-do-i-snakemake" title="how do I snakemake?" class="md-header-nav__button md-logo">
          
            <img src="../images/snake.svg" width="24" height="24">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <div class="md-flex__ellipsis md-header-nav__title" data-md-component="title">
          
            
              <span class="md-header-nav__topic">
                how do I snakemake?
              </span>
              <span class="md-header-nav__topic">
                Converting Workflows to Snakemake
              </span>
            
          
        </div>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          
            <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
            
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="query" data-md-state="active">
      <label class="md-icon md-search__icon" for="search"></label>
      <button type="reset" class="md-icon md-search__icon" data-md-component="reset" tabindex="-1">
        &#xE5CD;
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result">
          <div class="md-search-result__meta">
            Type to start searching
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
          
        
      </div>
      
        <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            


  


  <a href="https://git.charlesreid1.com/charlesreid1/how-do-i-snakemake" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      charlesreid1/how-do-i-snakemake
    </div>
  </a>

          </div>
        </div>
      
    </div>
  </nav>
</header>
    
    <div class="md-container">
      
        
      
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" data-md-level="0">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <span class="md-nav__button md-logo">
      
        <img src="../images/snake.svg" width="48" height="48">
      
    </span>
    how do I snakemake?
  </label>
  
    <div class="md-nav__source">
      


  


  <a href="https://git.charlesreid1.com/charlesreid1/how-do-i-snakemake" title="Go to repository" class="md-source" data-md-source="">
    
    <div class="md-source__repository">
      charlesreid1/how-do-i-snakemake
    </div>
  </a>

    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." title="Index" class="md-nav__link">
      Index
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installing/" title="Installing Snakemake" class="md-nav__link">
      Installing Snakemake
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../terminology/" title="Snakemake Terminology" class="md-nav__link">
      Snakemake Terminology
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="toc">
        Converting Workflows to Snakemake
      </label>
    
    <a href="./" title="Converting Workflows to Snakemake" class="md-nav__link md-nav__link--active">
      Converting Workflows to Snakemake
    </a>
    
      
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-filtering-sequencer-reads" title="Example: Filtering Sequencer Reads" class="md-nav__link">
    Example: Filtering Sequencer Reads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-1-shell-script-snakefile" title="Stage 1: Shell Script + Snakefile" class="md-nav__link">
    Stage 1: Shell Script + Snakefile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-shell-script" title="The Shell Script" class="md-nav__link">
    The Shell Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakemake-strategy" title="The Snakemake Strategy" class="md-nav__link">
    The Snakemake Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakefile" title="The Snakefile" class="md-nav__link">
    The Snakefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-flags" title="Snakemake Flags" class="md-nav__link">
    Snakemake Flags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-snakemake" title="Running Snakemake" class="md-nav__link">
    Running Snakemake
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakemake-directory" title="The .snakemake Directory" class="md-nav__link">
    The .snakemake Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#re-running-snakemake" title="Re-running Snakemake" class="md-nav__link">
    Re-running Snakemake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-2-replace-script-with-snakefile-hard-coded" title="Stage 2: Replace Script with Snakefile (Hard-Coded)" class="md-nav__link">
    Stage 2: Replace Script with Snakefile (Hard-Coded)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-3-replace-script-with-snakefile-wildcards" title="Stage 3: Replace Script with Snakefile (Wildcards)" class="md-nav__link">
    Stage 3: Replace Script with Snakefile (Wildcards)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
    
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#example-filtering-sequencer-reads" title="Example: Filtering Sequencer Reads" class="md-nav__link">
    Example: Filtering Sequencer Reads
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-1-shell-script-snakefile" title="Stage 1: Shell Script + Snakefile" class="md-nav__link">
    Stage 1: Shell Script + Snakefile
  </a>
  
    <nav class="md-nav">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#the-shell-script" title="The Shell Script" class="md-nav__link">
    The Shell Script
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakemake-strategy" title="The Snakemake Strategy" class="md-nav__link">
    The Snakemake Strategy
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakefile" title="The Snakefile" class="md-nav__link">
    The Snakefile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#snakemake-flags" title="Snakemake Flags" class="md-nav__link">
    Snakemake Flags
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#running-snakemake" title="Running Snakemake" class="md-nav__link">
    Running Snakemake
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#the-snakemake-directory" title="The .snakemake Directory" class="md-nav__link">
    The .snakemake Directory
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#re-running-snakemake" title="Re-running Snakemake" class="md-nav__link">
    Re-running Snakemake
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-2-replace-script-with-snakefile-hard-coded" title="Stage 2: Replace Script with Snakefile (Hard-Coded)" class="md-nav__link">
    Stage 2: Replace Script with Snakefile (Hard-Coded)
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#stage-3-replace-script-with-snakefile-wildcards" title="Stage 3: Replace Script with Snakefile (Wildcards)" class="md-nav__link">
    Stage 3: Replace Script with Snakefile (Wildcards)
  </a>
  
</li>
      
      
      
      
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                <h1 id="converting-workflows-to-snakemake">Converting Workflows to Snakemake<a class="headerlink" href="#converting-workflows-to-snakemake" title="Permanent link">&para;</a></h1>
<p>One of the common questions about Snakemake is, <strong>how should beginners get
started?</strong></p>
<p>When you're starting out with Snakemake, one of the first hurdles you'll
encounter is a big gap between the examples (simple) and your real-world
workflow (complicated).</p>
<p>Snakemake is a relatively new (but well-documented) piece of software, so there
aren't a lot of examples, and the ones you can find will leave you wanting more.
Starting out, you'll find that (nearly) every step of your workflow presents
some kind of corner case that's not covered in any Snakemake examples.</p>
<p>Two recommendations to help overcome this:</p>
<ol>
<li>
<p>Don't <em>start</em> with Snakemake - start with shell scripts. Get your pipeline
   working as a shell script or a list of commands first, using a small data set.
   <em>Then</em> convert the workflow to Snakemake.</p>
</li>
<li>
<p>Converting your workflow from shell scripts to a Snakefile can happen in
   <em>stages</em>. Start with a single Snakemake rule that calls a single bash shell
   script that downloads all of the reads at once (handle the complexity in the
   shell script).  Eventually, you can start to break up the shell script into
   smaller parts, and convert some of those parts into separate Snakemake rules.</p>
</li>
</ol>
<h2 id="example-filtering-sequencer-reads">Example: Filtering Sequencer Reads<a class="headerlink" href="#example-filtering-sequencer-reads" title="Permanent link">&para;</a></h2>
<p>Let's illustrate the process of converting a workflow from shell scripts to a
Snakefile, and doing so in stages, using a hypothetical workflow that involves
downloading data files containing reads from a sequencer from an external URL:</p>
<table>
<thead>
<tr>
<th>Read Files</th>
<th>URL (note: these links are fake)</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>SRR606_1_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR606_1_reads.fq.gz">http://example.com/SRR606_1_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR606_2_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR606_2_reads.fq.gz">http://example.com/SRR606_2_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR607_1_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR607_1_reads.fq.gz">http://example.com/SRR607_1_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR607_2_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR607_2_reads.fq.gz">http://example.com/SRR607_2_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR608_1_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR608_1_reads.fq.gz">http://example.com/SRR608_1_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR608_2_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR608_2_reads.fq.gz">http://example.com/SRR608_2_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR609_1_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR609_1_reads.fq.gz">http://example.com/SRR609_1_reads.fq.gz</a></td>
</tr>
<tr>
<td><code>SRR609_2_reads.fq.gz</code></td>
<td><a href="http://example.com/SRR609_2_reads.fq.gz">http://example.com/SRR609_2_reads.fq.gz</a></td>
</tr>
</tbody>
</table>
<h2 id="stage-1-shell-script-snakefile">Stage 1: Shell Script + Snakefile<a class="headerlink" href="#stage-1-shell-script-snakefile" title="Permanent link">&para;</a></h2>
<h3 id="the-shell-script">The Shell Script<a class="headerlink" href="#the-shell-script" title="Permanent link">&para;</a></h3>
<p>Start out with a single Snakemake rule that calls a single bash shell script
that downloads all the reads. Here is a shell script that uses for loop magic
to download each of the read files:</p>
<p><strong><code>download_reads.sh</code>:</strong></p>
<table class="codehilitetable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26</pre></div></td><td class="code"><div class="codehilite"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1"># </span>
<span class="c1"># Download some fake read files</span>

<span class="c1"># Fail on the first error</span>
<span class="nb">set</span> -e

<span class="nv">reads</span><span class="o">=</span><span class="s2">&quot; SRR606_1_reads.fq.gz</span>
<span class="s2">SRR606_2_reads.fq.gz</span>
<span class="s2">SRR607_1_reads.fq.gz</span>
<span class="s2">SRR607_2_reads.fq.gz</span>
<span class="s2">SRR608_1_reads.fq.gz</span>
<span class="s2">SRR608_2_reads.fq.gz</span>
<span class="s2">SRR609_1_reads.fq.gz</span>
<span class="s2">SRR609_2_reads.fq.gz&quot;</span>

<span class="k">for</span> <span class="nb">read</span> in <span class="nv">$reads</span><span class="p">;</span> <span class="k">do</span>

    <span class="nb">echo</span> <span class="s2">&quot;Now downloading read file: </span><span class="si">${</span><span class="nv">read</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="c1"># Download the read file&#39;s (fake) URL</span>
    curl -L https://example.com/<span class="si">${</span><span class="nv">read</span><span class="si">}</span> -o <span class="si">${</span><span class="nv">read</span><span class="si">}</span>

    <span class="nb">echo</span> <span class="s2">&quot;Done.&quot;</span>

<span class="k">done</span>
</pre></div>
</td></tr></table>

<p>The <code>set -e</code> option will stop execution of the script if any errors are
encountered. If any of the downloads fail, the shell script will fail, and 
the Snakemake <code>download_reads</code> rule will fail.</p>
<p>Paste this into <code>download_reads.sh</code>, and run the following command on
the command line to make <code>download_reads.sh</code> executable:</p>
<div class="codehilite"><pre><span></span>$ chmod download_reads.sh
</pre></div>


<h3 id="the-snakemake-strategy">The Snakemake Strategy<a class="headerlink" href="#the-snakemake-strategy" title="Permanent link">&para;</a></h3>
<p>Now we want to create a Snakefile with a single very simple rule called
<code>download_reads</code> that will call <code>download_reads.sh</code>. </p>
<p>Right away, we run into a challenge: Snakemake operates using files and
filenames to infer which rules to run and which rules to skip.  That means any
Snakemake rule to download read files needs to have a list of files that will
only be present if the rule that runs the download reads script has successfully
run.</p>
<p>If we want to have Snakemake run the <code>download_reads.sh</code> script with a single
rule, our options, in order of worst to best, are:</p>
<ul>
<li>
<p><strong>(WORST)</strong> We can tell Snakemake the name of every read file (copy-and-paste from the
  shell script into the Snakefile) so it knows what read files should be
  present when the download script has run. This requires duplicating the 
  list of read file names across two files - <strong>YUCK!!!</strong></p>
</li>
<li>
<p><strong>(BETTER BUT STILL BAD)</strong> We can tell Snakemake the name of <em>one</em> read file, so
  that if that one read file is present, Snakemake will assume the rest are also
  present and that the <code>download_reads.sh</code> script has already been run. This has
  the same disadvantage of needing to keep read file names coordinated across
  two separate files, but also has the disadvantage that it cannot detect if the
  process of downloading reads actually completed, or if it was only partially
  completed. </p>
</li>
<li>
<p><strong>(BEST)</strong> We can bypass the use of the read files altogether and use a handy
  command, <code>touch</code>, to create a simple empty file whose presence indicates the
  download reads step has run. When we instruct Snakemake to run the download
  reads script, we add a command like <code>touch .downloaded_reads</code>, so that if the
  file <code>.downloaded_reads</code> is present, the rule will not be run.</p>
</li>
</ul>
<p>Why do we use a file prefixed with a dot? That keeps the file hidden when we run <code>ls</code>
and keeps our working directory clean. </p>
<p>We need to tell Snakemake that the dotfile we touch is the output of the rule,
so that it knows to link the dotfile <code>.downloaded_reads</code> with the rule
<code>download_reads</code>. To do that, we use Snakemake's <code>touch()</code> command when we
specify the output files from the rule.</p>
<div class="admonition tip">
<p class="admonition-title">Tip: Running shell scripts with Snakemake</p>
<p>If you are writing a Snakemake rule that runs a shell script that outputs
multiple files, you can avoid keeping duplicate lists of files in both the
shell script and the Snakefile by defining the output of the Snakemake rule
that runs the shell script to be a dotfile (file whose name starts with a
dot, so it is hidden) that is touched when the rule is finished.</p>
<p>Use Snakemake's <code>touch()</code> function in the <code>output:</code> section of your rule.</p>
</div>
<h3 id="the-snakefile">The Snakefile<a class="headerlink" href="#the-snakefile" title="Permanent link">&para;</a></h3>
<p>Our Snakefile will define a single rule to run the shell script using
the command above. This Snakefile demonstrates a couple of concepts:</p>
<ul>
<li>Using the <code>touch()</code> function to link the <code>.downloaded_reads</code> dotfile with
  the <code>download_reads</code> rule</li>
<li>Using a normally-defined Python variable inside of a Snakemake rule</li>
<li>Documenting a rule using a triple-quoted Python docstring and using
  Python-style <code>#</code> comments</li>
</ul>
<p><strong><code>Snakefile</code>:</strong></p>
<div class="codehilite"><pre><span></span><span class="n">touchfile</span> <span class="o">=</span> <span class="s1">&#39;.downloaded_reads&#39;</span>

<span class="n">rule</span> <span class="n">download_reads</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Run a shell script that downloads all of our read files.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">output</span><span class="p">:</span>
        <span class="c1"># This rule is now linked to this touchfile</span>
        <span class="n">touch</span><span class="p">(</span><span class="n">touchfile</span><span class="p">)</span>
    <span class="n">shell</span><span class="p">:</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        ./download_reads.sh</span>
<span class="sd">        &#39;&#39;&#39;</span>
</pre></div>


<p>Paste the Python code above into a file called <code>Snakefile</code>.</p>
<h3 id="snakemake-flags">Snakemake Flags<a class="headerlink" href="#snakemake-flags" title="Permanent link">&para;</a></h3>
<p>Before we run Snakemake, let's cover two useful flags:</p>
<ul>
<li>
<p>The <code>--dryrun</code> or <code>-n</code> option will print out the rules that Snakemake would
  run, but does not actually run them.</p>
</li>
<li>
<p>The <code>--printshellcmds</code> or <code>-p</code> option will print out the shell command
  associated with each rule.</p>
</li>
</ul>
<p>See <a href="https://snakemake.readthedocs.io/en/stable/executable.html#all-options">Executing
Snakemake</a>
in the Snakemake documentation for a complete list of command line
arguments that Snakemake accepts.</p>
<h3 id="running-snakemake">Running Snakemake<a class="headerlink" href="#running-snakemake" title="Permanent link">&para;</a></h3>
<p>Start by making sure you have Snakemake installed (see the <a href="../installing/">Installing
Snakemake</a> page for instructions).</p>
<p>When you run the <code>snakemake</code> command without specifying a target, it 
will determine a default target and run that. The default target is the
first rule in the Snakefile.</p>
<p>Alternatively, we can specify the <code>download_reads</code> target when we run Snakemake.</p>
<p>From the command line, run the following:</p>
<div class="codehilite"><pre><span></span>snakemake --dryrun --printshellcmds download_reads
</pre></div>


<p>This should show us that Snakemake will run a single rule and a single command:</p>
<div class="codehilite"><pre><span></span>$ snakemake --dryrun --printshellcmds download_reads
Building DAG of jobs...
Job counts:
    count   jobs
    1   download_reads
    1

rule download_reads:
    output: .downloaded_reads
    jobid: 0


        ./download_reads.sh

Job counts:
    count   jobs
    1   download_reads
    1
</pre></div>


<p>When we run the command without the <code>--dryrun</code> option, we should see
the output from several curl commands:</p>
<div class="codehilite"><pre><span></span>$ snakemake --printshellcmds download_reads
Building DAG of jobs...
Using shell: /usr/local/bin/bash
Provided cores: 1
Rules claiming more threads will be scaled down.
Job counts:
    count   jobs
    1   download_reads
    1

rule download_reads:
    output: .downloaded_reads
    jobid: 0


        ./download_reads.sh

Now downloading read file: SRR606_1_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   2346      0 --:--:-- --:--:-- --:--:--  2347
Now downloading read file: SRR606_2_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   6214      0 --:--:-- --:--:-- --:--:--  6195
Now downloading read file: SRR607_1_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   5191      0 --:--:-- --:--:-- --:--:--  5204
Now downloading read file: SRR607_2_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   5296      0 --:--:-- --:--:-- --:--:--  5313
Now downloading read file: SRR608_1_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   5981      0 --:--:-- --:--:-- --:--:--  5990
Now downloading read file: SRR608_2_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   6177      0 --:--:-- --:--:-- --:--:--  6165
Now downloading read file: SRR609_1_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   4482      0 --:--:-- --:--:-- --:--:--  4487
Now downloading read file: SRR609_2_reads.fq.gz
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  1270  100  1270    0     0   5558      0 --:--:-- --:--:-- --:--:--  5570
Touching output file .downloaded_reads.
Finished job 0.
1 of 1 steps (100%) done
Complete log:
/tmp/how-do-i-snakemake/.snakemake/log/2018-07-16T145427.253977.snakemake.log
</pre></div>


<p>Notice that Snakemake does not touch the file <code>.downloaded_reads</code> until it
completes running the script. It is important to add the <code>set -e</code> command 
to any shell script being run this way, because otherwise the script
will keep going when it encounters errors, and Snakemake will think the
script completed successfully and will touch <code>.downloaded_reads</code>.</p>
<h3 id="the-snakemake-directory">The <code>.snakemake</code> Directory<a class="headerlink" href="#the-snakemake-directory" title="Permanent link">&para;</a></h3>
<p>The above script was run from <code>/tmp/how-do-i-snakemake</code>. Snakemake created a
directory called <code>.snakemake/</code> to store its own files. Snakemake automatically
creates a log of what occurred in <code>.snakemake/log/</code> in a timestamped log file:</p>
<div class="codehilite"><pre><span></span>/tmp/how-do-i-snakemake/.snakemake/log/2018-07-16T145427.253977.snakemake.log
</pre></div>


<h3 id="re-running-snakemake">Re-running Snakemake<a class="headerlink" href="#re-running-snakemake" title="Permanent link">&para;</a></h3>
<p>If you re-run Snakemake, it will find the <code>.downloaded_reads</code> file and will
not download the files again:</p>
<div class="codehilite"><pre><span></span>$ snakemake
Building DAG of jobs...
Nothing to be done.
Complete log: /private/tmp/how-do-i-snakemake/.snakemake/log/2018-07-16T165657.111397.snakemake.log
</pre></div>


<p>You can force Snakemake to re-download the files two ways:</p>
<ul>
<li>
<p>Remove the output dotfile that the rule creates; this will cause Snakemake
  to detect that the output file for the rule is missing, and it will re-run
  the rule.</p>
</li>
<li>
<p>Run Snakemake with the <code>--force</code> flag.</p>
</li>
</ul>
<h2 id="stage-2-replace-script-with-snakefile-hard-coded">Stage 2: Replace Script with Snakefile (Hard-Coded)<a class="headerlink" href="#stage-2-replace-script-with-snakefile-hard-coded" title="Permanent link">&para;</a></h2>
<h2 id="stage-3-replace-script-with-snakefile-wildcards">Stage 3: Replace Script with Snakefile (Wildcards)<a class="headerlink" href="#stage-3-replace-script-with-snakefile-wildcards" title="Permanent link">&para;</a></h2>
                
                  
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../terminology/" title="Snakemake Terminology" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Snakemake Terminology
              </span>
            </div>
          </a>
        
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2018 <a href="https://charlesreid1.com">Charles Reid</a>, released under the <a href="https://opensource.org/licenses/MIT">MIT license</a> <br /><br /> <div>Snake icon made by Freepik, obtained from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a>, used under a <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div> license.
          </div>
        
        powered by
        <a href="http://www.mkdocs.org">MkDocs</a>
        and
        <a href="https://squidfunk.github.io/mkdocs-material/">
          Material for MkDocs</a>
      </div>
      
        
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application.0cf9b500.js"></script>
      
      <script>app.initialize({version:"0.17.3",url:{base:".."}})</script>
      
        <script src="../search/require.js"></script>
      
        <script src="../search/search.js"></script>
      
    
    
      
    
  </body>
</html>